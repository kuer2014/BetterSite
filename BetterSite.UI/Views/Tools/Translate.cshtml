@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>双语阅读助手</title>
    <link href="~/Content/bootstrap_min.css" rel="stylesheet" />
</head>
<body>
    <div class="container">

        <div class="page-header">
            <h1>双语阅读助手</h1>
            <p class="lead">提取生词、词组、短语</p>
        </div>
        <h3>翻译助手</h3>
        <p>双击单词 <strong>自动选中，并显示单词解释、相关词组和短语</strong>可添加单词到生词本，并保存到本地</p>
        <div class="row">
            <div class="col-md-6">
                <div class="panel panel-default" style="margin-bottom:0px;">
                    <div class="panel-heading">英文文章</div>
                    <div class="panel-body" style="padding:0;">
                        <textarea id="source" class="form-control" rows="15" style="border:0;">
                            Only when he finished his homework did he realize that he had made a mistake. People say that money cannot buy happiness. This was true for Howard Hughes.
                            He was one of the richest and most powerful men of his time.
                        </textarea>
                    </div>
                </div>
                <div>
                    <span>查询历史:</span>
                    <span id="searchhistory"></span>
                </div>
                <div class="panel panel-default" style="margin-top:10px;">
                    <div class="panel-heading">全文翻译</div>
                    <div class="panel-body">


                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="panel panel-default">
                    <div class="panel-heading">单词解释</div>
                    <div class="panel-body" id="wordmeans">

                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">相关词组和短语</div>
                    <div class="panel-body" id="wordsuggst">
                     
                    </div>
                </div>
            </div>
            <div class="col-md-3">

                <div class="panel panel-default">
                    <div class="panel-heading">生词本</div>
                    <div class="panel-body">
                        Panel content<br />
                        People say that money cannot buy happiness. This was true for Howard Hughes. <br />
                        He was one of the richest and most powerful men of his time.
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- /container -->
    <script src="~/Scripts/jquery-1.8.2.min.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/jquery.cookie.js"></script>
    <script type="text/javascript">
        $(function () {
            //if ($.cookie('d')) {
            //    var cachewords = $.cookie('d').split(',');
            //    $('#searchhistory').html(cachewords.join());
            //}
            BuildHistory();
            $("#source").dblclick(Search) ;
        })
       // var word = '';     

        function Search(wordtxt) {
            if (wordtxt) {
                //$("#source").select(function(){

                //word=document.selection.createRange().text;
                if (!(typeof wordtxt == 'string'))
                    wordtxt = document.getSelection().toString();
                
                //word= document.execCommand('Copy');
                word = wordtxt.toLocaleLowerCase().trim();
                if (word) {
                    //追加单词解释
                    BuildMeans(word);
                    // 追加单词联想（词组短语等）
                    BuildSuggst(word);
                    //保存历史
                    BuildHistory(word);
                }
            }
        };
        //追加单词解释
        function BuildMeans(word) {
            var wordStrArr = [];
            $.ajax({
                //url: 'http://api.fanyi.baidu.com/api/trans/vip/translate',
                url: 'http://www.iciba.com/index.php?a=getWordMean&c=search&word=' + word,
                type: 'get',
                dataType: 'jsonp',
                data: {
                },
                success: function (data) {
                    //   debugger;
                    if (data && data.errno == 0) {
                        var baseInfo = data.baesInfo;
                        if (baseInfo.symbols && baseInfo.symbols.length > 0) {//成功查到
                            //1
                            wordStrArr.push('<div><h4>' + baseInfo.word_name + '</h4> </div>');
                            //2
                            var symbol = baseInfo.symbols[0];
                            wordStrArr.push('<div>英: [<b>' + symbol.ph_en + '</b>] 美: [<b>' + symbol.ph_am + '</b>] </div>');
                            //3
                            wordStrArr.push('<div>高频词: <b>' + (baseInfo.frequence == undefined ? 0 : baseInfo.frequence) + '/5</b>');
                            var wordTag = baseInfo.word_tag;
                            if (wordTag && wordTag.length > 0) {
                                var tagStr = ' ';
                                var tagDic = { '0': '考研', '1': 'CET6', '2': 'CET4', '3': 'GRE', '4': 'TOEFL', '5': 'IELTS' };
                                $(wordTag).each(function (i, ele) {
                                    tagStr += tagDic[ele] + ' ';
                                })
                                wordStrArr.push(tagStr);
                            }
                            wordStrArr.push('</div>');
                            //4
                            if (symbol.parts && symbol.parts.length > 0) {
                                for (var i = 0; i < symbol.parts.length; i++) {
                                    var part = symbol.parts[i]
                                    wordStrArr.push('<div><b>' + part.part + '</b> ' + part.means.toString() + '</div>');
                                }
                            }
                            //5
                            var exchange = baseInfo.exchange;
                            if (exchange) {
                                wordStrArr.push('<div>过去式： ' + exchange.word_past + ' 过去分词： ' + exchange.word_past + ' 现在分词： ' + exchange.word_ing + ' 第三人称单数： ' + exchange.word_third + '</div>');
                            }
                            //追加单词解释
                            $('#wordmeans').html(wordStrArr.join(''));

                        } else {
                            $('#wordmeans').html('没有找到单词：' + word + '，请检查拼写是否正确。')
                        }
                    }
                    else {
                        $('#wordmeans').html(data.errmsg)
                    }
                }
            });
        }
        //追加单词联想（词组短语等）
        function BuildSuggst(word) {
            var wordStrArr = [];
            $.ajax({

                url: 'http://dict-mobile.iciba.com/interface/index.php?c=word&m=getsuggest&nums=10&client=6&is_need_mean=1&word=' + word,
                type: 'get',
                dataType: 'jsonp',
                data: {
                },
                success: function (data) {
                    if (data && data.status == 1) {
                        var wordList = data.message;
                        if (wordList && wordList.length > 0) {
                            for (var i = 0; i < wordList.length; i++) {
                                var word = wordList[i];
                                if (word && word.means && word.means.length > 0 && word.means[0].means) {
                                    //var wordgroup = word.means[0].means.toString();
                                    //if(wordgroup&&wordgroup.trim()&&wordgroup.indexOf(' ')>0)
                                    if (word.key && word.key.trim() && word.key.indexOf(' ') > 0)
                                        wordStrArr.push('<div><b>' + word.key + '</b> ' + word.means[0].means.toString() + '</div>');
                                }
                            }
                            $('#wordsuggst').html(wordStrArr.join(''));
                        } else {
                            $('#wordsuggst').html(wordStrArr.join('没有找到相关内容。'));
                        }
                    }
                }
            });
        }
        //历史查询记录
        function BuildHistory(word) {
            debugger;
            { //$.data()用法
            //if ($('#searchhistory').data('d') == undefined)
            //    var words = [];
            //else
            //    var words = $('#searchhistory').data('d');
            //words.push(word);
            //$('#searchhistory').data('d', words);
            }
            //$.cookie('the_cookie', 'the_value', { expires: 7 }); //添加
            //$.cookie('d', null); //删除
            if ($.cookie('d') == undefined)
                var words = [];
            else
                var words = $.cookie('d').split(',');
            if (word) {
                var wordindex = jQuery.inArray(word, words);
                if (wordindex>=0)
                {
                    words.splice(wordindex, 1);
                    words.unshift(word);
                }
                else {
                    words.unshift(word);
                    words.splice(5, 1);
                }
            }
            $.cookie('d', words.join(), { expires: 7 });
            var hishtml = [];
            $(words).each(function (i, ele) {
                hishtml.push('<span><a href="#" onclick="Search(\'' + ele + '\')" title="点击查询">' + ele + '</a></span>')
            });
            $('#searchhistory').html(hishtml.join(' , '));

        }
      
    </script>


</body>

</html>
